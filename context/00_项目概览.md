# 项目概览

NH Tours 是一个旅游管理系统，从原有的静态 HTML 网站重构为动态 Flask Web 应用，提供类似 WeTravel 的现代化后台管理系统。

## 目录

- [项目简介](#项目简介)
- [技术栈](#技术栈)
- [项目状态](#项目状态)
- [核心功能模块](#核心功能模块)
- [项目结构](#项目结构)

---

## 项目简介

### 项目背景

- **原项目**: 静态 HTML 网站（克隆自 nhtours.com，45个页面）
- **重构目标**: 动态 Flask Web 应用 + WeTravel 风格后台管理系统
- **核心价值**: 支持行程管理、在线预订、Stripe 支付处理及客户管理

### 项目阶段

| 阶段 | 状态 | 说明 |
|------|------|------|
| Phase 1 | ✅ 已完成 | 静态网站 → Flask 动态应用 |
| Phase 2 | 🔄 进行中 | WeTravel 风格后台管理系统 |

---

## 技术栈

### 后端

| 技术 | 用途 |
|------|------|
| Flask | Web 框架 |
| SQLAlchemy | ORM 数据库操作 |
| Flask-WTF | 表单处理和验证 |
| Flask-Login | 用户认证 |
| boto3 | AWS SES 邮件发送 |
| APScheduler | 定时任务（分期付款提醒） |
| Stripe | 支付处理 |

### 前端

| 技术 | 用途 |
|------|------|
| Jinja2 | 模板引擎 |
| Tailwind CSS | CSS 框架 |
| Heroicons | SVG 图标 |
| Quill.js | 富文本编辑器 |
| FullCalendar | 日历视图 |
| Vanilla JS | 原生 JavaScript（无重型框架） |

### 数据库

| 环境 | 数据库 |
|------|--------|
| 开发 | SQLite |
| 生产 | PostgreSQL（通过 SQLAlchemy 支持） |

### 部署

| 技术 | 用途 |
|------|------|
| Gunicorn/Waitress | WSGI 服务器 |
| Nginx | 反向代理、静态文件服务 |
| Docker | 容器化部署（可选） |

---

## 项目状态

### 已完成功能

#### 后台管理

- ✅ 行程管理（My Trips）：创建、编辑、发布行程
- ✅ Trip Builder：6 步向导式行程构建器
- ✅ 日历视图：FullCalendar 集成
- ✅ 客户管理：Customers / Leads 列表
- ✅ 订单管理：Booking 列表、搜索、筛选、导出 Excel
- ✅ 支付管理：Payment 记录、分期付款管理
- ✅ 退款功能：支持全款和部分退款

#### 前台功能

- ✅ 行程详情页
- ✅ 多步骤报名流程（5 步向导）
- ✅ Stripe 支付集成（Payment Element）
- ✅ 折扣码系统
- ✅ 分期付款支持

#### 系统功能

- ✅ 用户认证（Login/Logout）
- ✅ 邮件通知（AWS SES）
- ✅ 分期付款提醒（定时任务）

### 待完成功能

- ⏳ 分期付款页面模板优化
- ⏳ AWS SES 生产环境配置
- ⏳ 过期 PendingBooking 自动清理
- ⏳ 团队权限管理
- ⏳ 自动化测试（Pytest）

---

## 核心功能模块

### 1. 行程管理（My Trips）

- **卡片视图**: 图文卡片展示行程
- **日历视图**: FullCalendar 月/周切换
- **状态筛选**: Upcoming / Past / Draft

### 2. Trip Builder（行程构建器）

6 步向导式创建流程：

| 步骤 | 功能 |
|------|------|
| Step 1 | 基础信息（标题、日期、封面图） |
| Step 2 | 描述（富文本、包含/不包含列表） |
| Step 3 | 套餐管理（价格、支付计划） |
| Step 4 | 附加选项 |
| Step 5 | 购买者信息配置 |
| Step 6 | 参与者问卷 |
| Step 7 | 折扣码管理 |

### 3. 报名付款系统

- **多步骤报名**: 套餐选择 → 附加项 → 参与者信息 → 购买者信息 → 支付
- **支付方式**: 全款支付、定金 + 分期
- **Stripe 集成**: Payment Element、Webhook 处理

### 4. 分期付款系统

- **自动创建**: 首次支付后自动创建分期记录
- **提醒邮件**: 到期前 3 天、1 天、当天发送提醒
- **Payoff 功能**: 支持一次性付清剩余款项

---

## 项目结构

```
flask-app/
├── app/
│   ├── admin/              # 后台管理蓝图
│   ├── auth/               # 认证蓝图
│   ├── main/               # 前台蓝图
│   ├── templates/          # Jinja2 模板
│   ├── static/             # 静态资源
│   ├── models.py           # 数据库模型
│   ├── payments.py         # Stripe 支付逻辑
│   ├── tasks.py            # 定时任务
│   └── __init__.py         # App Factory
├── migrations/             # 数据库迁移
├── run.py                  # 启动入口
└── config.py               # 配置文件
```

---

## 更新日期

**最后更新**: 2026-01-21
