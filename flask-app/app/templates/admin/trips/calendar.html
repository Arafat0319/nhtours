{% extends "admin/base_wetravel.html" %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<div class="space-y-6">
    <!-- Header Area -->
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-2xl font-normal text-gray-500">
                Upcoming Trips
            </h2>
        </div>

        <div class="flex space-x-4">
            <!-- Reuse search and view toggle -->
            <div class="relative">
                <input type="text" placeholder="Search for participants and trips"
                    class="pl-8 pr-4 py-2 border border-gray-300 rounded text-sm w-64 focus:outline-none focus:border-wetravel-cyan">
                <svg class="w-4 h-4 text-wetravel-cyan absolute left-2.5 top-3" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>

            <!-- View Toggle -->
            <div class="border border-wetravel-cyan rounded flex overflow-hidden">
                <a href="{{ url_for('admin.trips', view='list', filter=filter_type) }}"
                    class="bg-white text-gray-400 hover:text-wetravel-cyan hover:bg-gray-50 px-3 py-1 flex items-center space-x-1 text-sm border-r border-wetravel-cyan">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <span>List</span>
                </a>
                <span class="bg-wetravel-cyan text-white px-3 py-1 flex items-center space-x-1 text-sm cursor-default">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <span>Calendar</span>
                </span>
            </div>
        </div>
    </div>

    <!-- Calendar Container -->
    <div class="bg-white p-6 rounded shadow-sm">
        <div id="calendar"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            contentHeight: 'auto', // Better for dynamic height
            aspectRatio: 1.8, // Make cells wider relative to height
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: ''
            },
            events: '{{ url_for("admin.trips_json") }}',
            eventContent: function (arg) {
                // Custom event rendering to match WeTravel style
                // arg.event.extendedProps.spots_sold / capacity
                let spots = arg.event.extendedProps.spots_sold || 0;
                let cap = arg.event.extendedProps.capacity || 25;

                let el = document.createElement('div');
                el.className = 'p-1 text-xs overflow-hidden';
                el.innerHTML = `
                    <div class="font-bold truncate">${arg.event.title}</div>
                    <div class="flex items-center text-gray-100 mt-0.5" style="font-size: 0.7rem;">
                        <svg class="w-3 h-3 mr-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                        <span>${spots}/${cap} going</span>
                    </div>
                `;
                return { domNodes: [el] }
            },
            eventClick: function (info) {
                if (info.event.url) {
                    window.location.href = info.event.url;
                    info.jsEvent.preventDefault();
                }
            }
        });
        calendar.render();

        // Force update size after a short delay to fix rendering glitches
        setTimeout(function () {
            calendar.updateSize();
        }, 100);
    });
</script>

<style>
    /* Custom override for FullCalendar to match WeTravel style */
    .fc-toolbar-title {
        font-size: 1.25rem !important;
        color: #6B7280;
        font-weight: 400;
    }

    .fc-button-primary {
        background-color: white !important;
        color: #00D1C1 !important;
        border: none !important;
        box-shadow: none !important;
        font-weight: 500;
    }

    .fc-button-primary:hover {
        color: #00b3a6 !important;
    }

    .fc-button-active {
        color: #00D1C1 !important;
        font-weight: bold;
    }

    .fc-daygrid-event {
        border: none !important;
        border-radius: 4px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        border-left-width: 3px !important;
        border-left-style: solid !important;
        /* Border color will be inherited from the event's borderColor property set in JSON */
    }

    .fc-col-header-cell-cushion {
        color: #9CA3AF;
        font-weight: normal;
        font-size: 0.875rem;
    }

    .fc-daygrid-day-number {
        color: #9CA3AF;
        font-size: 0.875rem;
        padding: 8px;
    }
</style>
{% endblock %}